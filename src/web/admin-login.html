<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒêƒÉng nh·∫≠p Qu·∫£n tr·ªã</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
    <style>
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#0f172a,#1e293b)}
        .card{width:100%;max-width:420px;background:rgba(255,255,255,0.06);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.12);border-radius:16px;padding:28px;color:#fff;box-shadow:0 10px 30px rgba(0,0,0,0.3)}
        h1{font-size:22px;margin:0 0 6px 0}
        p.sub{margin:0 0 18px 0;color:#cbd5e1}
        .group{margin-bottom:14px}
        label{display:block;margin:0 0 6px 0;color:#e2e8f0;font-size:14px}
        input{width:100%;padding:12px 14px;border-radius:10px;border:1px solid #334155;background:#0b1220;color:#e2e8f0}
        button{width:100%;padding:12px 16px;border-radius:10px;border:0;background:#4f46e5;color:#fff;font-weight:600;cursor:pointer}
        button:disabled{opacity:.6;cursor:not-allowed}
        .msg{display:none;margin:10px 0;padding:10px;border-radius:8px;font-size:14px}
        .msg.err{background:rgba(239,68,68,.15);border:1px solid rgba(239,68,68,.35);color:#fecaca}
        .msg.ok{background:rgba(34,197,94,.15);border:1px solid rgba(34,197,94,.35);color:#bbf7d0}
        .links{margin-top:10px;text-align:center}
        .links a{color:#93c5fd;text-decoration:none}
    </style>
    <script src="config.js"></script>
    <script>
        // S·ª≠ d·ª•ng BACKEND_URL v√† ENDPOINTS t·ª´ CONFIG (ƒë√£ ƒë∆∞·ª£c c·∫•u h√¨nh trong config.js)
        // Auto-detect HTTPS ƒë·ªÉ tr√°nh Mixed Content error
        function getSafeBackendUrl() {
            // N·∫øu trang ƒëang HTTPS, lu√¥n d√πng domain hi·ªán t·∫°i (kh√¥ng d√πng IP)
            if (window.location.protocol === 'https:') {
                // N·∫øu c√≥ CONFIG v√† getSafeBackendUrl
                if (window.CONFIG?.getSafeBackendUrl) {
                    const url = window.CONFIG.getSafeBackendUrl();
                    // Double check: n·∫øu v·∫´n l√† IP, chuy·ªÉn sang domain
                    if (url && (url.includes('103.77.243.190') || url.match(/^\d+\.\d+\.\d+\.\d+/))) {
                        return window.location.protocol + '//' + window.location.hostname;
                    }
                    return url;
                }
                // N·∫øu c√≥ CONFIG.BACKEND_URL
                if (window.CONFIG?.BACKEND_URL) {
                    let url = window.CONFIG.BACKEND_URL;
                    // N·∫øu l√† IP, chuy·ªÉn sang domain
                    if (url.includes('103.77.243.190') || url.match(/^\d+\.\d+\.\d+\.\d+/)) {
                        return window.location.protocol + '//' + window.location.hostname;
                    }
                    // ƒê·∫£m b·∫£o HTTPS
                    if (url.startsWith('http://') && !url.includes('localhost') && !url.includes('127.0.0.1')) {
                        url = url.replace('http://', 'https://');
                    }
                    return url;
                }
                // Fallback: d√πng domain hi·ªán t·∫°i v·ªõi HTTPS
                return window.location.protocol + '//' + window.location.hostname;
            }
            // HTTP: d√πng CONFIG ho·∫∑c origin
            return window.CONFIG?.BACKEND_URL || window.location.origin;
        }
        
        const BACKEND_URL = getSafeBackendUrl();
        let API_BASE = window.CONFIG?.API?.url('ADMIN') || BACKEND_URL + (window.CONFIG?.ENDPOINTS?.ADMIN || '/api/admin.php');
        
        // Final check: ƒë·∫£m b·∫£o HTTPS v√† domain (kh√¥ng d√πng IP)
        if (window.location.protocol === 'https:') {
            // N·∫øu l√† IP, chuy·ªÉn sang domain
            if (API_BASE.includes('103.77.243.190') || API_BASE.match(/http:\/\/\d+\.\d+\.\d+\.\d+/) || API_BASE.match(/https:\/\/\d+\.\d+\.\d+\.\d+/)) {
                API_BASE = window.location.protocol + '//' + window.location.hostname + '/api/admin.php';
            } else if (API_BASE.startsWith('http://') && !API_BASE.includes('localhost') && !API_BASE.includes('127.0.0.1')) {
                API_BASE = API_BASE.replace('http://', 'https://');
            }
        }
        
        console.log('üîó Admin API URL:', API_BASE);
        async function loginAdmin(e){
            e.preventDefault();
            const u=document.getElementById('username').value.trim();
            const p=document.getElementById('password').value.trim();
            const btn=document.getElementById('btn');
            const ok=document.getElementById('ok');
            const err=document.getElementById('err');
            ok.style.display='none';err.style.display='none';
            if(!u||!p){err.textContent='Vui l√≤ng nh·∫≠p ƒë·ªß t√™n ƒëƒÉng nh·∫≠p v√† m·∫≠t kh·∫©u';err.style.display='block';return}
            btn.disabled=true;btn.textContent='ƒêang ƒëƒÉng nh·∫≠p...';
            try{
                const res=await fetch(API_BASE+'?action=login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:p})});
                const data=await res.json();
                if(!res.ok||!data.success){throw new Error(data.message||'ƒêƒÉng nh·∫≠p th·∫•t b·∫°i')}
                localStorage.setItem('admin_token',data.data.token);
                localStorage.setItem('admin_user',JSON.stringify(data.data.user));
                ok.textContent='ƒêƒÉng nh·∫≠p th√†nh c√¥ng!';ok.style.display='block';
                setTimeout(()=>location.href='admin-dashboard.html',800);
            }catch(e){err.textContent=e.message||'L·ªói server';err.style.display='block'}
            finally{btn.disabled=false;btn.textContent='ƒêƒÉng nh·∫≠p qu·∫£n tr·ªã'}
        }
        function guardIfLogged(){
            const token=localStorage.getItem('admin_token');
            if(token){location.href='admin-dashboard.html'}
        }
        document.addEventListener('DOMContentLoaded',guardIfLogged);
    </script>
    </head>
<body>
    <form class="card" onsubmit="loginAdmin(event)">
        <h1>B·∫£ng ƒëi·ªÅu khi·ªÉn - Admin</h1>
        <p class="sub">ƒêƒÉng nh·∫≠p ƒë·ªÉ qu·∫£n tr·ªã ng∆∞·ªùi d√πng v√† model</p>
        <div id="err" class="msg err"></div>
        <div id="ok" class="msg ok"></div>
        <div class="group">
            <label for="username">T√™n ƒëƒÉng nh·∫≠p</label>
            <input id="username" placeholder="admin" autocomplete="username" />
        </div>
        <div class="group">
            <label for="password">M·∫≠t kh·∫©u</label>
            <input id="password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" />
        </div>
        <button id="btn" type="submit">ƒêƒÉng nh·∫≠p qu·∫£n tr·ªã</button>
        <div class="links" style="margin-top:12px"><a href="index.html">‚Üê V·ªÅ trang ch·ªß</a></div>
    </form>
</body>
</html>



